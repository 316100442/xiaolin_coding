# tcp保活机制

> tcp连接在一个时间段内没有任何活动，保活机制的作用下，隔段时间发送探测报文

### 探活次数、时间间隔、保活时间
```
net.ipv4.tcp_keepalive_time=7200 (2 小时内如果没有任何连接相关的活动，则会启动保活机制)
net.ipv4.tcp_keepalive_intvl=75  (间隔 75 秒)
net.ipv4.tcp_keepalive_probes=9  (9 次无响应才会中断本次连接)
```


### TCP 保活的这个机制检测的时间是有点长，我们可以自己在应用层实现一个心跳机制


### 已经建立了连接，服务端进程崩溃了

> 内核会发送第一次挥手FIN报文，TCP四次挥手正常走完


### listen的backlog的意义

```
Linux内核中会维护两个队列

半连接队列（SYN 队列）
全连接队列（Accpet 队列）
```

> 服务端 accept 成功返回是在三次握手成功之后