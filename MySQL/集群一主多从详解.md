# 集群一主多从详解

### 主从的形式
```
一主一丛
一主多从
多主一丛
双主复制
级联复制
```

### 主从线程有哪三个线程
1. 主节点 binary log dump 线程 (发送bin-log设计文件加锁)(主节点会为每个slave创建一个该线程)
2. 从节点I/O线程 (读取bin-log后存储到relay-log)
3. 从节点SQL线程 (读取relay log并执行)

> master 端的binary log（bin-log）功能必须开启才能实施复制

### 复制模式
1. 异步模式（mysql async-mode）(主节点不主动push bin log给从节点)
```
主库执行完客户端事务提交后(notify Dump Thread Send Bin Log)立刻返回客户端
不关心从库是否已经接收并处理
```
2. 半同步模式(mysql semi-sync)(需要安装插件)
```
主库执行完客户端请求后(Notify Dump Thread)
等待至少1个slave接收并写入到relay log之中(注意这里是不在乎从库有没有执行relay log的)
才返回客户端
```
3. 全同步模式
```
主库执行完客户端的请求后(Notyfy Dum Thread)
会等待所有主库接收完bin-log并写入relay-log并执行完才返回给客户端
```

### BIN LOG数据格式(STATEMENT,ROW,MIXED)
1. statement-based replication，SBR (基于SQL语句的复制)
2. row-based replication，RBR(基于行变更的复制)(只记录哪条数据被修改了修改成什么样)(不会有因为函数\存储过程导致的复制失败)
3. mixed-based replication,MBR(混合模式复制)(优先STATEMENT模式,无法使用的就用ROW模式)

### GTID (global transaction identifier) 即全局事务ID复制模式
```
通过全局的事务 ID 确定从库要执行的事务的方式代替了以前需要用 Binlog 和 位点确定从库要执行的事务的方式
```

### Sync-binlog
```
0:文件系统自己控制binlog-cache到binlog的时机
1:每次事务提交，MySQL都会把binlog刷下去
```


[知乎-主从复制原理](https://zhuanlan.zhihu.com/p/164518315)
[主从复制原理](https://www.cnblogs.com/rickiyang/p/13856388.html)
[Sync-binlog配置](https://www.cnblogs.com/xuxubaobao/p/10839979.html)